\chapter{Improving the Radial Velocity Precision of HET/HRS}\label{chap:het}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction and Background}

This is about HET/HRS. This will have introduction to HET and HRS.

make sure to mention set up of slit in front of the fiber.

Motivation behinding using HRS, including its advantages, such as
queque schedule and fiber feed. However, it never performed on 1-2~m/s
level in terms of RV precision like \keck.

Temperature stability in the spectrograph room of \hrs\ was identified
early on as one of the contributing factors to the RV systematic
errors, and this issue was resolved since the installation of a fine
temperature control system in March 2008 (J.~Bean, L.~Ramsey,
P.~McQueen private communications). The temperature fluctuation is now
controlled down to $\ll$1~K from 10~K. We confirmed the improvement in RV
precision as a result of this upgrade in our analysis with the HD
37605 data, which is illustrated in the lower panel of
Figure~\ref{het:fig:tempstable}. The RMS of \hrs\ velocities with
respect to the best Keplerian fit of the HD 37605 system is 9 m/s for
data before March 2008, and it is reduced to 6 m/s for data
afterwards. Such improvement is encouraging, and a closer look at the
data and the intermediate products of the Doppler pipeline reveals
even more potential contributors to the RV instability of \hrs, which
is the theme of this chapter.


%----------------------------------------------------------------
% HD 37605 and the improvement on precision brought by temperature stabilization
% plot made by ~/ExoPlanet-2010-2011/Targets/37605/rv_plot/rvplot_NESSF2013.eps
% grabbed from ~/ExoPlanet-2010-2011/Professional_Development/201301-NESSF/proposal/
\begin{figure}
\centering
\includegraphics[scale=0.5]{het/37605.eps}
\caption{Illustration of the effects of temperature stabilization on
  \het\ RV precision, using data on the HD~37605 system (see
  Chapter~\ref{chap:planets}). The RMS of the RV residuals (bottom
  panel) against the best-fit two-planet Keplerian solution (solid
  line in top panel) has dropped from 9~m/s to 6~m/s (grey areas in
  the bottom plot) after implementation of fine temperature control in
  the spectrograph room in March 2008. The pre-2009 \het\ data are
  provided by the UT Austin group.
\label{het:fig:tempstable}}
\end{figure}
%----------------------------------------------------------------


We set out to first construct a data reduction and RV extraction
pipeline for \het, which is described in
Section~\ref{het:sec:pipeline}. Then we tried to improve the precision
by seeking out for a better instrumental profile (IP) model, i.e., a
functional form that can bring good fit to \het\ data, which is
documented in Section~\ref{het:sec:ip}. Section~\ref{het:sec:fts}
describes our efforts in validating the iodine cell Fourier Transform
Spectrometer (FTS) scans for \het\ and our investigation on the
plausible changes in cell properties.

Show a sig Dra RV plot.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Adoption of REDUCE and the CPS Doppler Code for HET/HRS}\label{het:sec:pipeline}

What we did to modify REDUCE and the CPS Doppler code to get HET working.

We modified the REDUCE reduction routines built by Dr.\ Sara Gettle
and Dr.\ Steve Bongiono for raw spectral data reduction. The most
important modification was to automate the routine for tracing the
echelle orders on the spectral image, which used to require
human-intervention (i.e., clicking on the echelle orders to help the
code recognize the traces). I also wrote wrapper routines to automate
patch reduction for \het\ observation programs or any single target
star.

In terms of adapting the CPS Doppler code, it was mostly for training
the code to recognize \het\ images, to work with our local file
structures, and to be able to produce DSST locally using \het\ data
(instead of using \keck\ DSST like we did initially, which does not
produce RVs as precise as using \het\ DSSTs).

%----------------------------------------------------------------
% Comparing Keck and HET IPs in Fourier space
% plot from screen shot of a slide in
% ~/ExoPlanet-2010-2011/Professional_Development/20150727-ThesisCommMeet/
% original plot is from ~/Exo../HET.../06-line.../powspec.pro and stored in ./plots/
\begin{figure}
\centering
\includegraphics[scale=0.35]{het/fftip.eps}
\caption{Fourier transform or power spectrum of a \het\ iodine-only
  spectrum (black dots) and its smoothed version (blue line). There is
  a clear signature of the \het\ slit at 4.3 pixel (corresponding to
  slit width for resolution R $=$ 60k). For comparison, the red curve
  is for \keck\ data, which shows no clear signiture of a slit,
  because \keck\ is not fiber-fed and the PSF of the star falls mostly
  within its slit.
\label{het:fig:fftip}}
\end{figure}
%----------------------------------------------------------------




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The Search for a Better Instrumental Profile}\label{het:sec:ip}

\input{het-ip.tex}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Investigation on the Iodine Cell and the Iodine Atlases}\label{het:sec:fts}

\input{het-fts.tex}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{The Investigation on Modal Noise}
 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Conclusion and Future Work}\label{het:sec:conclusion}
 
To summarize, we think that two of the major drivers behind \het's RV
systematic errors are {\em temperature issues with the iodine
cell (or inaccurate iodine atlas which fails to capture such changes)
and inaccurate modeling of the IPs}. 

Overall, the \het\ spectra exhibit more changes than the \keck\
spectra, which probably makes it harder to model and leads to its
large RV systematic error (Figure~\ref{het:fig:chunkvary}). These
variations may be due to temperature changes in the cell or
spectrograph changes such as IP or focus changes. Precise Doppler
spectroscopy requires great care to minimize any changes in the iodine
cell and spectrograph performance. For example, standard CPS \keck\
observations are preceded with a series of procedures which ensures
that (1) the spectrograph is very well focused and (2) the wavelength
solution for the CCD chip stays roughly the same, i.e., the ThAr lines
always land on the same pixels. \het\ does not perform these
procedures, to the best of our knowledge.

%----------------------------------------------------------------
% Chunk pixel flux variation comparison between Keck and HET
% plot made by
% ~/ExoPlanet-2010-2011/HET-HRS-IP/05-Iodine_FTS_investigation/chunk_variation/chunk_vary.pro
% and plot_chunk_vary.pro and saved therein
\begin{figure}
\centering
\subfloat{\includegraphics[scale=0.35]{het/het_chunk_variation.eps}}
\subfloat{\includegraphics[scale=0.35]{het/keck_chunk_variation.eps}}\
\subfloat{\includegraphics[scale=0.35]{het/line_spec_rms_keck_het.eps}}
\caption{Comparison between the amounts of variation in a spectral
chunk in $\sim 500$ \het\ and \keck\ lamp iodine observations,
respectively. The top two panels show the overplotted spectra in this
chunk, shifted and normalized so that the spectral lines match (using
cross correlation and interpolation; normalized using total counts in
this chunk). The black dots in each of the two top panels are the RMS
values of the normalized counts in each pixel, multiplied by 4 and
added by 0.5 for illustration purposes. The \het\ spectra exhibit
significantly more variation than the \keck\ spectra, and we discuss
potential reasons in Section~\ref{het:sec:conclusion}. The bottom
panel is ploting the pixel counts RMS as a function of the derivative
of the spectrum, which shows that the \het\ spectra have more
variation in both line centers/continuum and line wings than \keck.
\label{het:fig:chunkvary}}
\end{figure}
%----------------------------------------------------------------

Our adventure in improving the RV precision of \het, though incomplete
and sometimes inconclusive so far, have taught us several important
lessons for iodine-calibrated precise RV work:

\begin{itemize}
  \item The IP functional forms for fiber-fed spectrographs probably
differ quite significantly from slit-fed ones, and it is important to
find a good IP function which not only describes the IP well but also
has good convergence properties for the forward modeling.
fitter. Initial guesses on IP parameters could play an important role.
  \item The iodine atlas provided by FTS scans should not be taken for
granted as the ``ground truth''. There are challenges with FTS
measurements and data reduction for measuring absorption spectrum with
such a big spectral span. The cell can also change over time, nulling
any old FTS scans. Echelle spectrograph with hyper resolution like the
TS12 arm on the Tull Spectrograph is very helpful for validating
iodine atlas or checking cell quality.
  \item It is vital to stabilize the cell to a desired temperature
precicely and accurately, probably at least to $\pm$10$\degree$C or
even better at higher temperatures. Theoretical code computing iodine
lines such as IodineSpec5 is helpful for diagnosing problems with
iodine cells. One can imagine that this can also be helpful in
identifying permanent cell change like the one experienced by the
Lick/Hamilton cell, which compromised the usefulness of the
spectrograph for precise RV work fatally.
\end{itemize}

Looking forward, there are several things which can help solving the
mystery and hopefully eventually leading to an improvement in the RV
precision of \het:

{\bf (1) Determining cell temperature before extracting RVs} for each
observation. It is probably valuable to obtain FTS scans of the \het\
cell at various temperatures and interpolate between them to make a
finer model grids of iodine atlases at different
temperatures. Floating the temperature as a free parameter in RV
extraction is also an option, but the degeneracy it introduces will be
detrimental to the RV precision. Therefore, a better route is to use
the temperature-sensitive regions among the iodine spectrum to
determine the cell temperature first, then use the corresponding atlas
in the forward modeling process to determine RVs. Validating the
iodine atlas and temperature control
stability/reliability\footnote{The cell enclosure and temperature
controller for the \het\ used in our TS12 observations are the ones
for the new \het, which is troubling.} is crucial for the upgraded
\het.

{\bf (2) Finding a better IP function:} This can be first done through
fitting ThAr frames, and then tested via fitting B star $+$ iodine
frames, which would be a much easier task for observations with
pre-determined iodine cell temperature. We plan to continue to explore
possibilities with the modified Moffat function by adding
perturbations and providing good initial guesses.

{\bf (3) Examining the spectral data for modal noise or raw reduction
errors:} We have taken day time engineering data before the HET
shutdown/upgrade to test if modal noise is significant in \het\ data
in very high SNR regime. Although we have calculated that the number
of modes in the \het\ fiber is large enough that modal noise should
not be a concern, it would still be valuable to reduce and analyze
these data to prove this hypothesis.

More importantly, the upgraded \het\ has great promise in RV
precision, and carrying on these lessons is crucial for ensuring good
RV performance ($\sim$1~m/s) -- especially the lesson on iodine atlas
and cell temperatures. Chapter~\ref{chap:conclusion} has more
on the upgraded \het\ and related future work.



