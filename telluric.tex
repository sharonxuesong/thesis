% main text for the telluric section in keck.tex
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Introduction}\label{keck:telluric:intro}

The first exoplanets around main-sequence stars were discovered by the
radial velocity (RV) method, where precise Doppler spectroscopy
measures the wavelength shift of the host stars induced by the
gravitational pull of the planets \citep{1988ApJ...331..902C,
  1989Natur.339...38L, 1993ApJ...413..339H, 1995Natur.378..355M,
  1996ApJ...464L.153B}. Since then, the RV method has discovered
hundreds of planetary systems (see exoplanets.org; \citealt{eod2014})
and contributed to numerous confirmation and characterization of
exoplanets discovered by the transit method (e.g., for
\kepler\ follow-up observations; \citealt{Marcy2014}).

The current best RV precision is around 1~m/s \citep{eprv2015},
attainable via two wavelength calibration methods in the optical band:
ThAr lamp emission line calibration (e.g., ELODIE and HARPS;
\citealt{elodie, harps-s}; $\sim$400-690~nm) and iodine cell
absorption line calibration (e.g., Keck/HIRES and Magellan/PFS;
\citealt{butler1996, 2010SPIE.7735E..53C}; $\sim$500-620~nm). The
major obstacles for achieving a higher RV precision are: stellar
activity induced RV signals, instrumental effects, telluric
contamination, and limitation in data analysis \citep{eprv2015}.

Traditionally, telluric contamination is not considered as problematic
for precise RV in the optical. It is certainly a sever source of
spectral contamination and a bottleneck for achieving higher RV
precision in the near infra-red (NIR) region (e.g.,
\citealt{2010ApJ...713..410B}), where a large number of deep water and
methane lines reside. However, there is only a small wavelength
range in the optical that has deep telluric lines, and typically such
regions are simply thrown out for the purpose of precise RV analysis,
either by giving them zero weights in the cross correlation masks (for
ThAr calibrated spectra, e.g., \citealt{2002A&A...388..632P}) or
flagging them as bad pixels (for iodine calibrated spectra, e.g., for
Keck/HIRES).

Recently, the works by \cite{artigau2014} and \cite{cunha2014} have
characterized and mitigated the effects of telluric contamination in
the precise RV data taken by the ThAr-calibrated HARPS-S.
\cite{cunha2014} focuses on the issues with ``micro-telluric" lines
(shallow telluric absorption lines with $<1$-3\% depths), which are
recognized for the first time. \cite{cunha2014} fit and then divide
out the telluric lines in the observed spectra using synthetic
telluric spectra generated by the LBLRTM package (Line-By-Line
Radiative Transfer Model, \citealt{lblrtm}; with line lists from
HIgh-resolution TRANsmission molecular absorption database, or HITRAN,
\citealt{hitran2013}) and also TAPAS \citep{tapas}, which is a more
user-friendly but less flexible package wrapper using LBLRTM. They
concluded that the micro-tellurics have an impact (defined as RMS of
difference between RVs before and after micro-telluric removal) of
$\sim$10-20 cm/s for G stars observed with low to moderate air masses,
but the impact can be substantial in some cases to up to $\sim$0.5-1
m/s.

\cite{artigau2014} uses principal component analysis (PCA) to
empirically correct for telluric lines in HARPS-S data (both
micro-tellurics and the deep lines in the $\sim$630~nm region), and
combined PCA with rejection masking, they reduced the RV RMS by
$\sim$20~cm/s (and more significantly for the $\sim$630~nm
region). More recently, \cite{2016AAS...22713719S} characterized the
effects of telluric contamination and effectiveness of some typical
remedies (masking and modeling) for emission line-calibarated spectra
for the optical, broad optical (300-900~nm), and NIR. Their conclusion
for the optical region is similar to the results in \cite{artigau2014}
and \cite{cunha2014}.

This paper characterizes and corrects for the adverse effects of
telluric contamination under the context of iodine-calibrated precise
RV, especially for the micro-telluric lines. ZZZ We first describe our
methodology for characterizing the effects of tellurics in
Section~\ref{keck:telluric:method}, then... ZZZ



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Impacts of Micro-tellurics on RV Precision}\label{keck:telluric:method}

We performed end-to-end simulation of Keck data and analysis process
to access the impacts of micro-tellurics on RV precision. We use Keck
to demonstrate this because Keck has the highest precision. We chose
sig Dra and tau Ceti as our stars because they are RV standards which
have been observed hundreds of times with Keck/HIRES, and are also
favorite RV standards at other precise RV facilities. I really want to
add an M dwarf standard here as well!


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Methodology}

We simulated Keck observations on sig Dra and tau Ceti by using
synthetic stellar spectra of their respective spectral types (?) using
SME (ZZZ cite Valenti and Fischer). We simulated one spectrum for each
actual observed spectrum taken at Keck through the CPS programs. The
synthetic stellar spectra is multiplied with the iodine atlas to
create the standard iodine$+$ star RV observations. The multiplied
spectrum is then multiplied with the blaze function and convolved with
the observed spectral PSF, both derived from real observations for
each night. Poisson noise is added.

We then forward model the simulated spectra to extract RVs using the
CPS Keck code (ZZZ cite Johnson and Howard). We used the synthetic
stellar spectrum as the input stellar template. In reality, stellar
templates are derived from observed stellar spectra via deconvolution,
which would introduce additional errors. Using the same synthetic
stellar spectrum would eliminate such errors and isolate the problem
to telluric lines only.

We ran two sets of simulations: control and contaminated. In the
control, we only had stellar spectrum and iodine spectrum. In the
contaminated, we added in simulated telluric lines in the simulated
observed spectrum. The telluric lines were generated using TERRASPEC
(ZZZ cite Bender). We adopted the typical Mauna Kea atmospheric
condition (temperature and pressure profiles) and typical oxygen
column density (which in realiaty flucturate very little anyway). For
simplicity, we assumed the same water column density for every
observation, which is pwv$=1$mm, a little bit humid than a typical
Mauna Kea night (true? I think this is actually pretty typical). The
pair of simulated control and contaminated spectra have the same added
Poisson noise, and therefore any RV differences derived from these two
sets of simulation would reveal the net effect of telluric
contamination.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Results}

%----------------------------------------------------------------
% Telluric effect, no photon noise
% plot made by ~/Exo.../Keck.../simulate.../msplot.pro
\begin{figure}
\subfloat{\includegraphics[scale=0.38]{telluric/185144-rv-bc-rja01-rjb01.eps}}\
\subfloat{\includegraphics[scale=0.38]{telluric/10700-rv-bc-rja01-rjb01.eps}}
\caption{Effects of telluric lines manifested as correlation between
  RV and BC. Each point represents the difference in RV estimates for
  a pair of simulated spectra: one without telluric absorption, and
  one with telluric absorption on top of the stellar and iodine
  spectra. To isolate the effects of telluric lines, the simulated
  spectra used for this plot do not have Poisson noise added, and they
  have simple one-component Gaussian IPs which have fixed width and
  thus the IP parameters are all fixed to the true values in the RV extraction.
\label{telluric:fig:rjab}}
\end{figure}
%----------------------------------------------------------------


%----------------------------------------------------------------
% Telluric effect, with photon noise
% plot made by ~/Exo.../Keck.../simulate.../msplot.pro
\begin{figure}
\subfloat{\includegraphics[scale=0.38]{telluric/185144-rv-bc-rjc01-rjd01.eps}}\
\subfloat{\includegraphics[scale=0.38]{telluric/10700-rv-bc-rjc01-rjd01.eps}}
\caption{Same as Figure~\ref{telluric:fig:rjab}, but for simulated
  spectra with Poisson noise (and still the same simple IPs).
\label{telluric:fig:rjcd}}
\end{figure}
%----------------------------------------------------------------



%----------------------------------------------------------------
% Telluric effect, with photon noise and complex IPs
% plot made by ~/Exo.../Keck.../simulate.../msplot.pro
\begin{figure}
\subfloat{\includegraphics[scale=0.38]{telluric/185144-rv-bc-test0-test1.eps}}\
\subfloat{\includegraphics[scale=0.38]{telluric/10700-rv-bc-test0-test1.eps}}
\caption{Same as Figure~\ref{telluric:fig:rjab}, but for simulated
  spectra with Poisson noise and complex IPs that are similar to the
  ones in actual observations. IP parameters are not fixed in this
  case, so the code is fitting 12 additional parameters for the IP on
  top of the 3 for wavelength solution and Doppler shift (see
  Chapter~\ref{chap:doppler} for more details on the code).
\label{telluric:fig:rjcd}}
\end{figure}
%----------------------------------------------------------------



Micro-tellurics in the iodine region introduces RMS$=0.6$ m/s scatter
for GK stars (RV systematic error added in quadrature). Leaving
untreated, this would define the precision floor.

Additionally, it manifests as spurious signal at periods of a sidereal
year and harmonics, with an amplitude of 20 cm/s. This would affect
our ability to detect super-Earth in the habitable zone of GK stars
(Earth's signal is 8 cm/s). We have seen such spurious signal in Keck
data on many stars, and telluric contamination is one of the
contributing factors (see discussion for other factors).

For M stars... (probably worse)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Remedies and Effectiveness}

Plots: effects of full forward modeling (RV difference between modeled
and contaminated, modeled and control).

We demonstrate the effectiveness of several remedies. First, double
masking: probably a terrible idea. Throwing away the pixels will make
the fitter harder to converge, and introduce additional errors on the
scales larger than the effects of telluric lines
themselves. Additionally, it is hard to choose a flux cut-off
level. Throwing away too much would mean unstable solution and lower
RV precision, but masking too little would mean insufficient
removal of tellurics.

Second, full forward modeling plus some sort of masking for deep
lines. This is the most effective way. Modeling precision of
$\sim$90\% basically bring the adverse effects of tellurics down to
$<$10 cm/s. 90\% is very easy to achieve -- remember the
state-of-the-art is 1-2\%, and even consider errors induced by
modeling residuals caused by atmospheric wind or lack of knowledge on
linelist or broadening parameters or inaccurate knowledge on atmospheric
temperature/pressure profiles. The deep lines may not be modeled very
well. However, the statistical weighting procedure at the very end
will empirically quantify which chunks behave badly due to ineffective
modeling of telluric lines and thus throw out or de-weigh the chunks.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Discussion and Future Work}\label{keck:telluric:future}

In terms of application to real observations, this brings marginal
improvements to existing Keck data. We tested on sig Dra, tau Ceti,
and M stars, the differences are...

Important for MINERVA, HRS2, HPF2. Crucial for CARMENES, HPF, EPDS, SHREK,
ESPRESSO, SPiRou etc. White paper has suggested improvement on line
lists in HITRAN. EPRV2 has a lot of recommendations. That is the
future direction.
